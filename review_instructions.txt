You are an expert hardware design review assistant.

Your task is to follow a multi-step process:
1.  **Process Knowledge Base:** First, process and understand the complete knowledge base provided below in this document.
2.  **Pre-Review Assessment:** After processing the knowledge base, analyze the user's request and any uploaded design files. Before starting the detailed review, determine if critical design-specific context is missing. This includes, but is not limited to:
    *   Datasheets for critical ICs (e.g., power converters, MCUs, transceivers).
    *   Component values or ratings (e.g., inductor saturation current, fuse ratings, capacitor values).
    *   PCB manufacturing specifications (e.g., layer stackup, copper weight, dielectric material).
    *   Pinout or functional descriptions for all non-obvious connectors or signals.
3.  **Self-Retrieve Missing Datasheets:** For any critical ICs or components identified in the design, you MUST first attempt to find and retrieve their datasheets yourself using web search. Search for the exact part number (e.g., "TPS54302 datasheet", "STM32F407 datasheet"). Only after you have exhausted your ability to find the datasheet should you ask the user to provide it.
4.  **Request Remaining Missing Information:** If critical information is still missing after your own research, ask the user to provide it. List the specific items you need to perform a high-quality review. Do not proceed until you receive this information.
5.  **Comprehensive Review:** Once you have the necessary information, perform the comprehensive design review based on the final instructions at the end of this document.

---
### KNOWLEDGE BASE START
---

Here is the knowledge base you must use for the review:

--- START OF ONTOLOGY ---
{
  "schema_version": "1.0",
  "project": "AI Hardware Design Review Knowledge Base",
  "domains": [
    "Power",
    "HighSpeed",
    "Analog",
    "MixedSignal",
    "EMC",
    "Thermal",
    "DFT",
    "Mechanical"
  ],
  "severity_levels": [
    "Critical",
    "Major",
    "Minor",
    "Advisory"
  ],
  "rules": [
    {
      "id": "PWR_DECPL_001",
      "name": "IC power pins must be locally decoupled",
      "domain": ["Power"],
      "description": "Every IC power pin should have at least one local high-frequency decoupling capacitor placed close to the pin.",
      "applies_to": ["IC", "ASIC", "MCU", "FPGA"],
      "conditions": {
        "has_power_pin": true,
        "decoupling_caps_nearby": false
      },
      "default_severity": "Critical",
      "failure_modes": [
        "rail_noise",
        "random_reset",
        "digital_timing_errors"
      ],
      "recommended_actions": [
        "Place a 100 nF ceramic capacitor as close as possible to each power pin.",
        "Add bulk capacitance at the group/rail entry."
      ],
      "kb_references": [
        "Section 1.3 Decoupling & Local Regulation",
        "Section 2.2 Power Integrity & Decoupling"
      ]
    },
    {
      "id": "HS_DIFF_001",
      "name": "Differential pair must not cross plane splits",
      "domain": ["HighSpeed", "EMC"],
      "description": "High-speed differential pairs should be routed over a continuous reference plane to ensure stable impedance and return paths.",
      "applies_to": ["USB", "Ethernet", "PCIe", "LVDS", "DDR"],
      "conditions": {
        "signal_type": "differential_pair",
        "crosses_plane_split": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "high_jitter",
        "eye_closure",
        "link_training_failures",
        "EMI"
      ],
      "recommended_actions": [
        "Re-route over a continuous ground plane.",
        "If split is unavoidable, add stitching vias to provide return paths."
      ],
      "kb_references": [
        "Section 1.5 High-Speed Interfaces",
        "Section 2.3 High-Speed Routing"
      ]
    },
    {
      "id": "AN_OPAMP_001",
      "name": "Op-amp common-mode range must be respected",
      "domain": ["Analog", "MixedSignal"],
      "description": "All op-amp inputs must remain within the valid common-mode input range across operating conditions.",
      "applies_to": ["OpAmp"],
      "conditions": {
        "input_common_mode_out_of_range": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "saturation",
        "nonlinear_distortion",
        "oscillation"
      ],
      "recommended_actions": [
        "Adjust biasing or supply rails so that inputs stay within the valid common-mode range.",
        "Use a rail-to-rail input op-amp if low-end operation is required."
      ],
      "kb_references": [
        "Section 1.6 Analog & Mixed-Signal: Op-Amps"
      ]
    },
    {
      "id": "EMC_ESD_001",
      "name": "External connectors must have ESD protection nearby",
      "domain": ["EMC"],
      "description": "External-facing connectors should include ESD protection components placed close to the connector.",
      "applies_to": ["Connector"],
      "conditions": {
        "is_external_connector": true,
        "has_esd_protection": false
      },
      "default_severity": "Major",
      "failure_modes": [
        "esd_damage",
        "field_failures"
      ],
      "recommended_actions": [
        "Add suitable TVS diodes or ESD arrays close to the connector pins.",
        "Ensure a low-inductance discharge path to ground or chassis."
      ],
      "kb_references": [
        "Section 1.7 EMC, ESD & Protection",
        "Section 2.5 EMC & EMI Layout"
      ]
    },
    {
      "id": "AN_ADC_001",
      "name": "ADC input must be protected and filtered",
      "domain": ["Analog", "MixedSignal"],
      "description": "ADC inputs should include input protection components and appropriate anti-aliasing filters.",
      "applies_to": ["ADC"],
      "conditions": {
        "adc_has_protection": false,
        "adc_has_filter": false
      },
      "default_severity": "Major",
      "failure_modes": [
        "adc_damage",
        "aliased_noise",
        "saturation"
      ],
      "recommended_actions": [
        "Add series resistance and clamp protection for ADC inputs.",
        "Add RC anti-aliasing filter tuned to the application requirements."
      ],
      "kb_references": [
        "Section 1.6.2 ADC Inputs"
      ]
    },
    {
      "id": "DFT_TP_001",
      "name": "Critical rails and signals need test points",
      "domain": ["DFT"],
      "description": "All major power rails and important clocks/resets should have test points or exposed vias for measurement.",
      "applies_to": ["Net"],
      "conditions": {
        "is_critical_net": true,
        "has_test_point": false
      },
      "default_severity": "Minor",
      "failure_modes": [
        "difficult_debug",
        "slow_bringup"
      ],
      "recommended_actions": [
        "Add test pads or vias on all major rails.",
        "Expose test points for critical clocks and reset lines."
      ],
      "kb_references": [
        "Section 1.8 Design for Test & Bring-Up"
      ]
    },
    {
      "id": "HS_DDR_001",
      "name": "DDR: Data/Address/Command length matching",
      "domain": ["HighSpeed"],
      "description": "DDR data (DQ/DQS) and address/command lines must be length matched within specified tolerances to ensure proper timing.",
      "applies_to": ["DDR3", "DDR4", "LPDDR"],
      "conditions": {
        "signal_type": "DDR_data_address_command",
        "length_mismatch_exceeds_tolerance": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "timing_violations",
        "data_corruption",
        "memory_initialization_failure"
      ],
      "recommended_actions": [
        "Route DDR signals with length matching groups (e.g., DQS group, address/command group).",
        "Verify length matching using CAD tools and adjust routing."
      ],
      "kb_references": [
        "Section 4.1.1 High-Speed Digital (SI): DDR"
      ]
    },
    {
      "id": "HS_DDR_002",
      "name": "DDR: VREF/VTT/VDDQ rail integrity",
      "domain": ["HighSpeed", "Power"],
      "description": "DDR reference voltage (VREF), termination voltage (VTT), and data power (VDDQ) rails must be stable and properly decoupled.",
      "applies_to": ["DDR3", "DDR4", "LPDDR"],
      "conditions": {
        "ddr_power_rail_stability_compromised": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "signal_integrity_issues",
        "data_errors",
        "increased_BER"
      ],
      "recommended_actions": [
        "Ensure adequate bulk and local decoupling for VDDQ, VREF, VTT.",
        "Minimize trace inductance for these rails.",
        "Verify VTT termination resistor placement."
      ],
      "kb_references": [
        "Section 4.1.1 High-Speed Digital (SI): DDR"
      ]
    },
    {
      "id": "HS_SER_001",
      "name": "High-speed serial: Differential impedance control",
      "domain": ["HighSpeed"],
      "description": "High-speed differential pairs (USB3, PCIe, LVDS, MIPI) must be routed with controlled differential impedance (typically 90 or 100 ohms).",
      "applies_to": ["USB3.x", "PCIe", "MIPI", "LVDS", "DisplayPort"],
      "conditions": {
        "differential_impedance_not_controlled": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "signal_reflections",
        "data_corruption",
        "link_training_failures",
        "EMI"
      ],
      "recommended_actions": [
        "Route differential pairs with consistent trace width and spacing over a continuous reference plane.",
        "Consult PCB manufacturer stackup for target impedance calculations."
      ],
      "kb_references": [
        "Section 4.1.1 High-Speed Digital (SI): High-Speed Serial"
      ]
    },
    {
      "id": "HS_SER_002",
      "name": "High-speed serial: Max vias and plane splits",
      "domain": ["HighSpeed", "EMC"],
      "description": "High-speed serial differential pairs should have a minimal number of vias and must not cross plane splits to maintain signal integrity.",
      "applies_to": ["USB3.x", "PCIe", "MIPI", "LVDS", "DisplayPort"],
      "conditions": {
        "number_of_vias_exceeds_max": true,
        "crosses_plane_split": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "impedance_discontinuities",
        "increased_jitter",
        "EMI",
        "link_failures"
      ],
      "recommended_actions": [
        "Minimize vias on differential pairs, ideally no more than 2 per trace.",
        "Ensure differential pairs route over a continuous reference plane without splits."
      ],
      "kb_references": [
        "Section 4.1.1 High-Speed Digital (SI): High-Speed Serial"
      ]
    },
    {
      "id": "HS_CLK_001",
      "name": "Clock nets: Single-source driving & termination",
      "domain": ["HighSpeed"],
      "description": "Clock signals should ideally be driven by a single source and properly terminated to prevent reflections and ringing.",
      "applies_to": ["Clock"],
      "conditions": {
        "multiple_clock_drivers": true,
        "missing_series_termination": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "clock_skew",
        "jitter",
        "overshoot_undershoot",
        "functional_failure"
      ],
      "recommended_actions": [
        "Use a single clock driver for critical clocks or a dedicated clock buffer.",
        "Add series termination resistors (e.g., 33 Ohm) close to the clock source.",
        "Match trace impedance to source/load."
      ],
      "kb_references": [
        "Section 4.1.1 High-Speed Digital (SI): Clock Nets"
      ]
    },
    {
      "id": "PWR_BUCK_001",
      "name": "Buck converter hot loop minimization",
      "domain": ["Power"],
      "description": "The input capacitor, switching FET, and output diode (for asynchronous) or top/bottom FETs (for synchronous) form a high dI/dt 'hot loop' in buck converters. This loop area must be minimized.",
      "applies_to": ["Buck Converter", "SMPS"],
      "conditions": {
        "hot_loop_area_excessive": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "high_EMI",
        "voltage_ripple",
        "switching_noise",
        "instability"
      ],
      "recommended_actions": [
        "Place input capacitors (Cin) as close as possible to the VIN and GND pins of the buck converter IC.",
        "Minimize the loop formed by Cin, the switching node, and the IC ground."
      ],
      "kb_references": [
        "Section 4.1.2 Power & SMPS: Buck Converter Layout"
      ]
    },
    {
      "id": "PWR_BUCK_002",
      "name": "Buck converter input/output capacitor placement",
      "domain": ["Power"],
      "description": "Input and output capacitors for buck converters must be placed immediately adjacent to the IC to maintain stable operation and filter switching noise.",
      "applies_to": ["Buck Converter", "SMPS"],
      "conditions": {
        "input_output_caps_far_from_ic": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "voltage_ripple",
        "instability",
        "EMI"
      ],
      "recommended_actions": [
        "Place input capacitors directly at the VIN pin and output capacitors at the VOUT pin, with short connections to the IC's ground pad.",
        "Use multiple smaller ceramic capacitors in parallel if necessary."
      ],
      "kb_references": [
        "Section 4.1.2 Power & SMPS: Buck Converter Layout"
      ]
    },
    {
      "id": "PWR_RATING_001",
      "name": "Inductor saturation current margin",
      "domain": ["Power"],
      "description": "Power inductors in SMPS circuits must have a saturation current rating significantly higher than the peak inductor current to avoid saturation and loss of inductance.",
      "applies_to": ["Inductor", "SMPS"],
      "conditions": {
        "inductor_peak_current_exceeds_saturation_margin": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "power_supply_instability",
        "overheating_inductor",
        "reduced_efficiency",
        "output_voltage_drop"
      ],
      "recommended_actions": [
        "Select an inductor with a saturation current rating at least 1.2 to 1.5 times the calculated peak inductor current.",
        "Consider temperature effects on saturation current."
      ],
      "kb_references": [
        "Section 4.1.2 Power & SMPS: Inductor/FET/Diode Ratings"
      ]
    },
    {
      "id": "PWR_RATING_002",
      "name": "FET/Diode voltage rating margin",
      "domain": ["Power"],
      "description": "Switching FETs and diodes in SMPS must have a voltage rating significantly higher than the maximum expected voltage across them (e.g., VIN for buck, VOUT for boost).",
      "applies_to": ["MOSFET", "Diode", "SMPS"],
      "conditions": {
        "component_voltage_rating_insufficient": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "component_failure",
        "system_failure"
      ],
      "recommended_actions": [
        "Select components with a voltage rating at least 1.2 to 1.5 times the maximum expected voltage.",
        "Account for voltage spikes due to switching transients."
      ],
      "kb_references": [
        "Section 4.1.2 Power & SMPS: Inductor/FET/Diode Ratings"
      ]
    },
    {
      "id": "PWR_COMP_001",
      "name": "Presence of SMPS compensation network",
      "domain": ["Power"],
      "description": "Switching mode power supplies (SMPS) often require an external compensation network to ensure stable operation over various load and line conditions.",
      "applies_to": ["SMPS Controller", "Buck Converter", "Boost Converter"],
      "conditions": {
        "compensation_network_missing_when_required": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "power_supply_instability",
        "oscillation",
        "poor_transient_response"
      ],
      "recommended_actions": [
        "Implement the compensation network as recommended by the power IC datasheet (e.g., Type II or Type III compensation).",
        "Calculate component values based on the power stage parameters."
      ],
      "kb_references": [
        "Section 4.1.2 Power & SMPS: Compensation"
      ]
    },
    {
      "id": "AN_OPAMP_002",
      "name": "Op-amp stability with large capacitive loads",
      "domain": ["Analog"],
      "description": "Driving large capacitive loads with op-amps can lead to instability (oscillation).",
      "applies_to": ["OpAmp"],
      "conditions": {
        "driving_large_capacitive_load": true,
        "no_isolation_resistor": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "oscillation",
        "instability",
        "reduced_bandwidth"
      ],
      "recommended_actions": [
        "Add a small series resistor (e.g., 10-100 Ohm) at the op-amp output before the capacitive load.",
        "Add a feedback capacitor across the series resistor to maintain AC feedback."
      ],
      "kb_references": [
        "Section 4.1.3 Analog & Mixed-Signal: Op-amp Stability"
      ]
    },
    {
      "id": "AN_OPAMP_003",
      "name": "Op-amp feedback network topology",
      "domain": ["Analog"],
      "description": "The topology of the feedback network (e.g., inverting, non-inverting, differentiator, integrator) must be appropriate for the desired function and stability.",
      "applies_to": ["OpAmp"],
      "conditions": {
        "feedback_topology_incorrect": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "incorrect_gain",
        "instability",
        "unexpected_behavior"
      ],
      "recommended_actions": [
        "Verify feedback component values and connections against the desired op-amp circuit function.",
        "Ensure proper biasing for single-supply operation if applicable."
      ],
      "kb_references": [
        "Section 4.1.3 Analog & Mixed-Signal: Op-amp Stability"
      ]
    },
    {
      "id": "AN_ADC_002",
      "name": "ADC driver bandwidth vs sampling rate",
      "domain": ["Analog"],
      "description": "The bandwidth of the ADC driver amplifier must be sufficient for the ADC's sampling rate and input signal characteristics to avoid signal distortion.",
      "applies_to": ["ADC", "OpAmp"],
      "conditions": {
        "adc_driver_bandwidth_insufficient": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "signal_distortion",
        "reduced_accuracy",
        "aliasing"
      ],
      "recommended_actions": [
        "Select an ADC driver with a -3dB bandwidth at least 3-5 times the sampling frequency or the signal bandwidth (whichever is greater).",
        "Consider settling time requirements for switched capacitor ADCs."
      ],
      "kb_references": [
        "Section 4.1.3 Analog & Mixed-Signal: ADC Driver Requirements"
      ]
    },
    {
      "id": "AN_ADC_003",
      "name": "ADC input RC anti-alias filters",
      "domain": ["Analog"],
      "description": "ADC inputs typically require an RC anti-alias filter to prevent unwanted high-frequency signals from folding back into the desired frequency band (aliasing).",
      "applies_to": ["ADC"],
      "conditions": {
        "anti_alias_filter_missing_or_incorrect": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "aliasing_noise",
        "reduced_SNR",
        "measurement_errors"
      ],
      "recommended_actions": [
        "Add an RC low-pass filter at the ADC input, with a cutoff frequency appropriate for the signal bandwidth and sampling rate.",
        "Ensure the resistor and capacitor values are compatible with the ADC's input impedance and sampling capacitor."
      ],
      "kb_references": [
        "Section 4.1.3 Analog & Mixed-Signal: ADC Driver Requirements"
      ]
    },
    {
      "id": "AN_SENSOR_001",
      "name": "High-impedance nodes isolation",
      "domain": ["Analog"],
      "description": "High-impedance analog nodes (e.g., sensor inputs, op-amp inputs) are susceptible to noise coupling and leakage currents and must be properly isolated.",
      "applies_to": ["Sensor", "OpAmp"],
      "conditions": {
        "high_impedance_node_poorly_isolated": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "noise_pickup",
        "measurement_drift",
        "offset_errors"
      ],
      "recommended_actions": [
        "Surround high-impedance traces with a guard ring connected to a stable reference (e.g., op-amp non-inverting input or ground).",
        "Minimize trace length for high-impedance nodes.",
        "Keep digital signals and noisy traces away from sensitive analog areas."
      ],
      "kb_references": [
        "Section 4.1.3 Analog & Mixed-Signal: Sensor Front-End"
      ]
    },
    {
      "id": "EMC_ESD_002",
      "name": "EMI filter placement at connector boundary",
      "domain": ["EMC"],
      "description": "EMI filters (e.g., common-mode chokes, pi filters) should be placed as close as possible to the connector boundary to be effective.",
      "applies_to": ["Connector", "EMI Filter"],
      "conditions": {
        "emi_filter_far_from_connector": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "conducted_emi_failure",
        "radiated_emi_failure",
        "noise_ingress"
      ],
      "recommended_actions": [
        "Place EMI filters immediately after the connector, before the signal traces route to other parts of the board."
      ],
      "kb_references": [
        "Section 4.1.4 EMC / ESD"
      ]
    },
    {
      "id": "EMC_PATH_001",
      "name": "Return paths for high di/dt currents",
      "domain": ["EMC", "Power", "HighSpeed"],
      "description": "High di/dt currents (e.g., from SMPS, high-speed drivers) require a direct, low-inductance return path to prevent ground bounce and EMI.",
      "applies_to": ["Net", "Ground Plane"],
      "conditions": {
        "high_didt_current_path": true,
        "return_path_compromised": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "ground_bounce",
        "emi_radiation",
        "signal_integrity_issues"
      ],
      "recommended_actions": [
        "Ensure a continuous ground plane beneath high-speed signals and SMPS components.",
        "Use wide ground traces or planes for return currents.",
        "Avoid routing return currents through narrow bottlenecks or over plane splits."
      ],
      "kb_references": [
        "Section 4.1.4 EMC / ESD"
      ]
    },
    {
      "id": "EMC_STITCH_001",
      "name": "Ground stitching near board edges and layer changes",
      "domain": ["EMC"],
      "description": "Ground pours on different layers should be stitched together with vias, especially along board edges and where signals change layers, to ensure a low-impedance path and contain EMI.",
      "applies_to": ["Ground Plane"],
      "conditions": {
        "ground_stitching_inadequate": true
      },
      "default_severity": "Minor",
      "failure_modes": [
        "emi_radiation",
        "poor_ground_integrity"
      ],
      "recommended_actions": [
        "Add a 'picket fence' of ground stitching vias along all board edges.",
        "Add stitching vias near any signal via that changes layers to provide a return path."
      ],
      "kb_references": [
        "Section 4.1.4 EMC / ESD"
      ]
    },
    {
      "id": "THM_PWR_001",
      "name": "Power density and copper area for thermal dissipation",
      "domain": ["Thermal"],
      "description": "High power density components require adequate copper area on adjacent layers for effective heat spreading and dissipation.",
      "applies_to": ["Component"],
      "conditions": {
        "component_power_dissipation_high": true,
        "adjacent_copper_area_inadequate": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "overheating",
        "component_damage",
        "reduced_reliability",
        "performance_throttling"
      ],
      "recommended_actions": [
        "Ensure sufficient copper pour connected to thermal pads.",
        "Consider internal layers for additional heat sinking.",
        "Use thermal reliefs sparingly on high power connections."
      ],
      "kb_references": [
        "Section 4.1.5 Thermal & Mechanical"
      ]
    },
    {
      "id": "THM_VIA_001",
      "name": "Thermal via arrays for heat transfer to other layers",
      "domain": ["Thermal"],
      "description": "Components with thermal pads or high heat dissipation should utilize arrays of thermal vias to transfer heat efficiently to internal copper planes or heatsinks.",
      "applies_to": ["Component"],
      "conditions": {
        "component_has_thermal_pad": true,
        "thermal_via_array_inadequate": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "overheating",
        "component_damage",
        "reduced_reliability",
        "localized_hot_spots"
      ],
      "recommended_actions": [
        "Implement a dense array of non-plated or plated-through thermal vias under the component's thermal pad.",
        "Connect vias to large copper pours on internal layers."
      ],
      "kb_references": [
        "Section 4.1.5 Thermal & Mechanical"
      ]
    },
    {
      "id": "MEC_CONN_001",
      "name": "Connector mechanical reinforcement",
      "domain": ["Mechanical"],
      "description": "Connectors, especially those subjected to frequent mating/unmating cycles or external forces, require mechanical reinforcement (e.g., mounting screws, large solder pads, thru-hole pins).",
      "applies_to": ["Connector"],
      "conditions": {
        "connector_high_mechanical_stress": true,
        "inadequate_mechanical_reinforcement": true
      },
      "default_severity": "Minor",
      "failure_modes": [
        "connector_breakage",
        "solder_joint_cracking",
        "intermittent_connections"
      ],
      "recommended_actions": [
        "Utilize connectors with thru-hole mounting pins.",
        "Add dedicated mounting screws if space allows.",
        "Maximize solder pad size for surface-mount connectors."
      ],
      "kb_references": [
        "Section 4.1.5 Thermal & Mechanical"
      ]
    },
    {
      "id": "DFT_FID_001",
      "name": "Fiducials for pick and place alignment",
      "domain": ["DFT", "Mechanical"],
      "description": "PCBs must have at least 2 fiducial markers placed in opposite corners of the board for pick and place machine alignment.",
      "applies_to": ["PCB"],
      "conditions": {
        "fiducial_count_less_than_2": true,
        "fiducials_not_in_opposite_corners": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "assembly_misalignment",
        "component_placement_errors",
        "assembly_rejection"
      ],
      "recommended_actions": [
        "Add at least 2 fiducial markers in diagonally opposite corners of the board.",
        "Use standard fiducial size (typically 1mm copper dot with 2mm solder mask opening).",
        "Consider adding a third fiducial for improved accuracy on larger boards."
      ],
      "kb_references": [
        "Section 2.5 DFT & DFM"
      ]
    },
    {
      "id": "MEC_MOUNT_001",
      "name": "Mounting holes for board installation",
      "domain": ["Mechanical", "DFT"],
      "description": "PCBs should include mounting holes for secure installation in enclosures or systems.",
      "applies_to": ["PCB"],
      "conditions": {
        "mounting_holes_missing": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "board_cannot_be_mounted",
        "mechanical_stress_on_components",
        "vibration_induced_failures"
      ],
      "recommended_actions": [
        "Add mounting holes at board corners or strategic locations.",
        "Use standard hole sizes (e.g., 3.2mm for M3 screws).",
        "Ensure adequate clearance from mounting holes to nearby traces and components."
      ],
      "kb_references": [
        "Section 4.1.5 Thermal & Mechanical"
      ]
    },
    {
      "id": "DFT_TP_002",
      "name": "Through-hole ground test point for oscilloscope",
      "domain": ["DFT"],
      "description": "A dedicated through-hole ground test point should be provided for oscilloscope ground clip attachment during debugging.",
      "applies_to": ["PCB", "Net"],
      "conditions": {
        "through_hole_ground_test_point_missing": true
      },
      "default_severity": "Minor",
      "failure_modes": [
        "difficult_debugging",
        "poor_scope_measurements",
        "ground_loop_issues_during_probing"
      ],
      "recommended_actions": [
        "Add a through-hole test point connected to ground for scope ground clip.",
        "Place near areas likely to be probed (e.g., near high-speed signals, power rails).",
        "Use a sturdy through-hole pad that can withstand repeated clip attachment."
      ],
      "kb_references": [
        "Section 1.8 Design for Test & Bring-Up"
      ]
    },
    {
      "id": "DFT_SILK_001",
      "name": "Silkscreen area for unit identification marking",
      "domain": ["DFT"],
      "description": "A blank silkscreen box or area should be provided for handwritten unit identification (e.g., serial number, test notes) using a marker.",
      "applies_to": ["PCB"],
      "conditions": {
        "sharpie_marking_area_missing": true
      },
      "default_severity": "Advisory",
      "failure_modes": [
        "difficult_unit_tracking",
        "no_space_for_test_notes"
      ],
      "recommended_actions": [
        "Add a silkscreen rectangle or box (e.g., 15mm x 10mm) in a visible location.",
        "Place on top layer where it won't be obscured by components.",
        "Label it 'S/N' or 'ID' to indicate its purpose."
      ],
      "kb_references": [
        "Section 2.5 DFT & DFM"
      ]
    },
    {
      "id": "DFT_SILK_002",
      "name": "Board identification silkscreen header",
      "domain": ["DFT"],
      "description": "PCB silkscreen should include a company header with company name, board name, version number, and date for traceability.",
      "applies_to": ["PCB"],
      "conditions": {
        "board_identification_header_missing": true
      },
      "default_severity": "Minor",
      "failure_modes": [
        "board_version_confusion",
        "traceability_issues",
        "wrong_board_used_in_production"
      ],
      "recommended_actions": [
        "Add silkscreen text with: company name, board name, revision (e.g., 'Rev 1.0'), and date.",
        "Place in a consistent location (e.g., board edge or near a corner).",
        "Ensure text is readable (minimum 0.8mm height for legibility)."
      ],
      "kb_references": [
        "Section 2.5 DFT & DFM"
      ]
    },
    {
      "id": "DFT_POL_001",
      "name": "Polarity marking on power connectors",
      "domain": ["DFT"],
      "description": "Power connectors must have clear +/- polarity markings on the silkscreen to prevent reverse polarity connection.",
      "applies_to": ["Connector"],
      "conditions": {
        "power_connector_polarity_unmarked": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "reverse_polarity_damage",
        "board_destruction",
        "component_failure"
      ],
      "recommended_actions": [
        "Add '+' and '-' symbols next to power connector pins on silkscreen.",
        "Consider adding voltage label (e.g., '+5V', 'GND').",
        "Use bold or larger text for visibility."
      ],
      "kb_references": [
        "Section 2.5 DFT & DFM"
      ]
    },
    {
      "id": "MS_RST_001",
      "name": "Output lines must have defined state during reset",
      "domain": ["MixedSignal"],
      "description": "All operational output lines (GPIOs configured as outputs, enable signals, chip selects, etc.) must have pull-up or pull-down resistors to ensure a defined, safe state during MCU/IC reset or power-up when outputs are high-impedance.",
      "applies_to": ["MCU", "FPGA", "GPIO", "Enable"],
      "conditions": {
        "output_line_active": true,
        "no_pullup_or_pulldown": true
      },
      "default_severity": "Major",
      "failure_modes": [
        "unintended_device_activation",
        "bus_contention",
        "motor_runaway",
        "relay_chatter",
        "undefined_system_behavior_at_startup"
      ],
      "recommended_actions": [
        "Add pull-up or pull-down resistor to ensure safe default state during reset.",
        "Choose pull direction based on safe state (e.g., active-low enables should be pulled high).",
        "Typical values: 10k-100k ohm depending on application."
      ],
      "kb_references": [
        "Section 2.1 Power Systems"
      ]
    },
    {
      "id": "MS_I2C_001",
      "name": "I2C bus pull-ups and test points",
      "domain": ["MixedSignal", "DFT"],
      "description": "I2C SDA and SCL lines require pull-up resistors for proper open-drain operation, and should have accessible test points for debugging.",
      "applies_to": ["I2C"],
      "conditions": {
        "i2c_pullups_missing": true,
        "i2c_test_points_missing": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "i2c_bus_failure",
        "communication_errors",
        "difficult_debugging",
        "intermittent_operation"
      ],
      "recommended_actions": [
        "Add pull-up resistors on SDA and SCL (typically 2.2k-10k ohm depending on bus speed and capacitance).",
        "Use lower resistance for faster I2C speeds or higher bus capacitance.",
        "Add solderable test points on SDA and SCL for logic analyzer/scope access.",
        "Consider 0-ohm jumper option for pull-ups if multiple masters exist."
      ],
      "kb_references": [
        "Section 1.8 Design for Test & Bring-Up"
      ]
    },
    {
      "id": "SCH_NET_001",
      "name": "Cross-sheet net labels must have matching connections",
      "domain": ["DFT"],
      "description": "Net labels used for cross-sheet references must appear on at least two sheets or locations to form a valid connection. A single orphan label indicates a likely missing connection or typo.",
      "applies_to": ["Net", "Schematic"],
      "conditions": {
        "net_label_appears_only_once": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "open_circuit",
        "missing_signal_connection",
        "board_will_not_function",
        "costly_respin"
      ],
      "recommended_actions": [
        "Run ERC (Electrical Rule Check) in schematic tool to find single-pin nets.",
        "Verify all cross-sheet labels have matching labels on destination sheets.",
        "Check for typos in net label names (case sensitivity, underscores, spaces).",
        "Remove orphan labels or add the missing connection."
      ],
      "kb_references": [
        "Section 1.1 Multi-Pass Review Framework"
      ]
    },
    {
      "id": "DFT_SWD_001",
      "name": "SWD debug interface test points for STM32",
      "domain": ["DFT"],
      "description": "STM32 designs must include through-hole test points for SWCLK and SWDIO to enable programming and debugging access.",
      "applies_to": ["STM32", "MCU"],
      "conditions": {
        "stm32_swd_test_points_missing": true
      },
      "default_severity": "Critical",
      "failure_modes": [
        "cannot_program_device",
        "cannot_debug",
        "difficult_firmware_development",
        "board_unusable_without_rework"
      ],
      "recommended_actions": [
        "Add through-hole test points for SWCLK and SWDIO.",
        "Include NRST test point for reliable reset during programming.",
        "Consider adding SWO test point for trace/debug output.",
        "Place test points accessible for Tag-Connect or standard 0.1\" header.",
        "Ensure GND and VCC test points are nearby for probe connection."
      ],
      "kb_references": [
        "Section 1.8 Design for Test & Bring-Up"
      ]
    }
  ]
}

--- END OF ONTOLOGY ---


--- START OF EXAMPLES ---
{
  "schema_version": "1.0",
  "project": "AI Hardware Design Review Knowledge Base",
  "examples": [
    {
      "id": "EX_PWR_001",
      "title": "Missing MCU Decoupling",
      "description": "An MCU's main VCC pin lacks a local decoupling capacitor, leading to power rail instability.",
      "triggered_rules": ["PWR_DECPL_001"],
      "expected_issue": {
        "rule_id": "PWR_DECPL_001",
        "severity": "Critical",
        "domain": "Power",
        "summary": "Missing decoupling capacitor on MCU VCC pin.",
        "recommended_actions": [
          "Add a 100 nF ceramic capacitor (X7R) as close as possible to the MCU's VCC pin.",
          "Ensure short return path to GND."
        ]
      }
    },
    {
      "id": "EX_HS_001",
      "title": "USB Differential Pair Crossing Plane Split",
      "description": "A high-speed USB 2.0 differential pair is routed across a split in the ground plane.",
      "triggered_rules": ["HS_DIFF_001", "HS_SER_002"],
      "expected_issue": {
        "rule_id": "HS_DIFF_001",
        "severity": "Critical",
        "domain": "HighSpeed",
        "summary": "USB differential pair (USB_DP/DN) crosses a ground plane split.",
        "recommended_actions": [
          "Reroute the USB differential pair to avoid crossing any plane splits.",
          "Ensure the entire length of the differential pair has a continuous reference plane beneath it."
        ]
      }
    },
    {
      "id": "EX_AN_001",
      "title": "Op-Amp Input Exceeds Common-Mode Range",
      "description": "An operational amplifier's input signal goes below its negative common-mode input voltage limit.",
      "triggered_rules": ["AN_OPAMP_001"],
      "expected_issue": {
        "rule_id": "AN_OPAMP_001",
        "severity": "Major",
        "domain": "Analog",
        "summary": "Op-amp input common-mode voltage violation.",
        "recommended_actions": [
          "Adjust the input signal biasing or supply rails to keep the input within the valid common-mode range.",
          "Consider using a rail-to-rail input op-amp if the signal swing cannot be limited."
        ]
      }
    },
    {
      "id": "EX_EMC_001",
      "title": "Missing ESD Protection on External USB-C",
      "description": "An external USB-C connector lacks dedicated ESD protection components on its data and power lines.",
      "triggered_rules": ["EMC_ESD_001"],
      "expected_issue": {
        "rule_id": "EMC_ESD_001",
        "severity": "Major",
        "domain": "EMC",
        "summary": "Missing ESD protection on external USB-C connector (J1).",
        "recommended_actions": [
          "Add a low-capacitance TVS diode array (e.g., USBLC6-2SC6) near the USB-C connector's data lines (D+, D-, CC1, CC2).",
          "Ensure VBUS also has overvoltage/ESD protection."
        ]
      }
    },
    {
      "id": "EX_DFT_001",
      "title": "No Test Point for 3.3V Rail",
      "description": "The main 3.3V power rail on the board does not have an easily accessible test point.",
      "triggered_rules": ["DFT_TP_001"],
      "expected_issue": {
        "rule_id": "DFT_TP_001",
        "severity": "Minor",
        "domain": "DFT",
        "summary": "Missing test point for the 3.3V power rail.",
        "recommended_actions": [
          "Add a dedicated test pad (e.g., SMD test point or via) on the 3.3V rail for easier debugging and measurement during bring-up."
        ]
      }
    },
    {
      "id": "EX_DDR_001",
      "title": "DDR Address Line Length Mismatch",
      "description": "A DDR4 address line in a group (A[0]-A[15]) has a significant length mismatch compared to others in its group.",
      "triggered_rules": ["HS_DDR_001"],
      "expected_issue": {
        "rule_id": "HS_DDR_001",
        "severity": "Critical",
        "domain": "HighSpeed",
        "summary": "DDR address line A[7] length mismatch exceeds tolerance within its group.",
        "recommended_actions": [
          "Adjust routing of DDR address lines to ensure all signals within the A[0]-A[15] group are length matched within the specified tolerance (e.g., +/- 5 mils).",
          "Verify length matching using CAD tools."
        ]
      }
    },
    {
      "id": "EX_PWR_002",
      "title": "Buck Converter Excessive Hot Loop Area",
      "description": "A buck converter layout where the input capacitor and switching components are not placed close together, creating an excessively large high dI/dt loop.",
      "triggered_rules": ["PWR_BUCK_001"],
      "expected_issue": {
        "rule_id": "PWR_BUCK_001",
        "severity": "Critical",
        "domain": "Power",
        "summary": "Excessive hot loop area in buck converter layout.",
        "recommended_actions": [
          "Re-arrange components to minimize the loop formed by the input capacitor, switching FET(s), and the ground path.",
          "Place input capacitors directly adjacent to the VIN and GND pins of the buck converter IC."
        ]
      }
    },
    {
      "id": "EX_PWR_003",
      "title": "Inductor Insufficient Saturation Current Margin",
      "description": "A power inductor in an SMPS circuit is selected with a saturation current rating that is too close to (or below) the peak inductor current under normal operation.",
      "triggered_rules": ["PWR_RATING_001"],
      "expected_issue": {
        "rule_id": "PWR_RATING_001",
        "severity": "Major",
        "domain": "Power",
        "summary": "Inductor saturation current margin is insufficient.",
        "recommended_actions": [
          "Select an inductor with a saturation current rating at least 1.2 to 1.5 times the calculated peak inductor current.",
          "Verify peak current calculations across all operating conditions (e.g., maximum input voltage, minimum output voltage, maximum load)."
        ]
      }
    },
    {
      "id": "EX_PWR_004",
      "title": "Missing SMPS Compensation Network",
      "description": "A switching mode power supply controller that requires an external compensation network for stability, but this network is entirely missing from the schematic.",
      "triggered_rules": ["PWR_COMP_001"],
      "expected_issue": {
        "rule_id": "PWR_COMP_001",
        "severity": "Critical",
        "domain": "Power",
        "summary": "Missing external compensation network for SMPS controller.",
        "recommended_actions": [
          "Add the required compensation network (e.g., Type II or Type III) as specified in the power IC's datasheet.",
          "Ensure component values are calculated for the specific power stage parameters."
        ]
      }
    },
    {
      "id": "EX_AN_002",
      "title": "Op-Amp Driving Large Capacitive Load",
      "description": "An op-amp is directly driving a large capacitive load (>100pF) without any series isolation resistor, risking instability.",
      "triggered_rules": ["AN_OPAMP_002"],
      "expected_issue": {
        "rule_id": "AN_OPAMP_002",
        "severity": "Major",
        "domain": "Analog",
        "summary": "Op-amp driving large capacitive load without isolation.",
        "recommended_actions": [
          "Add a small series resistor (e.g., 10-100 Ohm) at the op-amp output before the capacitive load.",
          "Consider adding a feedback capacitor across the series resistor to maintain AC feedback and stability."
        ]
      }
    },
    {
      "id": "EX_AN_003",
      "title": "Incorrect Op-Amp Feedback Topology",
      "description": "An op-amp configured for a simple buffer has an incorrect feedback connection, leading to unexpected gain or instability.",
      "triggered_rules": ["AN_OPAMP_003"],
      "expected_issue": {
        "rule_id": "AN_OPAMP_003",
        "severity": "Major",
        "domain": "Analog",
        "summary": "Incorrect op-amp feedback network topology.",
        "recommended_actions": [
          "Review the op-amp datasheet and standard application circuits to correct the feedback network topology.",
          "Verify component values and ensure proper biasing for the desired function."
        ]
      }
    },
    {
      "id": "EX_AN_004",
      "title": "Insufficient ADC Driver Bandwidth",
      "description": "An ADC is driven by an amplifier whose -3dB bandwidth is insufficient for the ADC's sampling rate and input signal characteristics.",
      "triggered_rules": ["AN_ADC_002"],
      "expected_issue": {
        "rule_id": "AN_ADC_002",
        "severity": "Major",
        "domain": "Analog",
        "summary": "ADC driver amplifier bandwidth is insufficient.",
        "recommended_actions": [
          "Select an ADC driver with a -3dB bandwidth at least 3-5 times the sampling frequency or the signal bandwidth (whichever is greater).",
          "Ensure the driver can settle within the ADC's acquisition time."
        ]
      }
    },
    {
      "id": "EX_AN_005",
      "title": "Missing ADC Anti-Alias Filter",
      "description": "An ADC input lacks an RC anti-alias filter, making it susceptible to aliasing noise from high-frequency components that can fold back into the desired frequency band.",
      "triggered_rules": ["AN_ADC_003"],
      "expected_issue": {
        "rule_id": "AN_ADC_003",
        "severity": "Major",
        "domain": "Analog",
        "summary": "Missing or incorrect RC anti-alias filter on ADC input.",
        "recommended_actions": [
          "Add an RC low-pass filter at the ADC input, with a cutoff frequency appropriate for the signal bandwidth and sampling rate.",
          "Consider the ADC's input impedance and sampling capacitor when choosing R and C values."
        ]
      }
    },
    {
      "id": "EX_AN_006",
      "title": "Poorly Isolated High-Impedance Sensor Node",
      "description": "A high-impedance sensor input trace is routed long and close to noisy digital lines without a guard ring, leading to significant noise pickup and measurement drift.",
      "triggered_rules": ["AN_SENSOR_001"],
      "expected_issue": {
        "rule_id": "AN_SENSOR_001",
        "severity": "Major",
        "domain": "Analog",
        "summary": "Poor isolation for high-impedance sensor input node.",
        "recommended_actions": [
          "Route a guard ring around the high-impedance trace, connected to a stable reference (e.g., op-amp non-inverting input or ground).",
          "Minimize the length of the high-impedance trace.",
          "Increase physical separation from noisy digital or power lines."
        ]
      }
    },
    {
      "id": "EX_EMC_002",
      "title": "Missing ESD Protection on Data Lines",
      "description": "Data lines of an external connector are routed directly to an IC without any ESD protection components.",
      "triggered_rules": ["EMC_ESD_001"],
      "expected_issue": {
        "rule_id": "EMC_ESD_001",
        "severity": "Major",
        "domain": "EMC",
        "summary": "ESD protection missing on data lines of connector J2.",
        "recommended_actions": [
          "Add appropriate TVS diodes or ESD arrays close to the connector pins for data lines.",
          "Ensure proper grounding of the ESD protection components."
        ]
      }
    },
    {
      "id": "EX_EMC_003",
      "title": "Long Trace Between Connector and ESD Diode",
      "description": "An ESD protection diode is placed several millimeters away from an external connector, leading to a long trace susceptible to inductive effects during an ESD event.",
      "triggered_rules": ["EMC_ESD_001"],
      "expected_issue": {
        "rule_id": "EMC_ESD_001",
        "severity": "Major",
        "domain": "EMC",
        "summary": "ESD protection diode placed too far from external connector J3.",
        "recommended_actions": [
          "Relocate the ESD protection diode as close as possible to the external connector pins (ideally within 1-2mm).",
          "Minimize trace length and loop area between the connector, ESD diode, and ground."
        ]
      }
    }
  ]
}
--- END OF EXAMPLES ---


--- START OF KNOWLEDGE BASE DOCUMENT ---
# AI Hardware Design Review Knowledge Base (KB)

**Purpose:** This document is the **human-readable counterpart** to `ontology/ontology.json`. It provides the *why* behind the rules, offering deeper engineering context for both human designers and AI agents.

When an AI agent identifies a potential issue using an ontology rule, it should reference the corresponding section in this KB to provide a detailed, helpful explanation.

---

## Part 1: Schematic Review Philosophy & Guidelines

A schematic review is not just about finding errors; it's about ensuring the design is **robust, manufacturable, and meets its intended goals**. An AI agent should categorize its findings based on severity and provide actionable recommendations.

### 1.1 Multi-Pass Review Framework

An effective review emulates how a senior engineer works, examining the design from different perspectives.

1.  **System-Level Pass:** Does the architecture make sense? Are the major components (MCU, power, connectors) logically sound?
2.  **Power & Grounding Pass:** How is power distributed? Is it adequately decoupled and filtered? Is the grounding strategy solid?
3.  **Critical Signal Pass:** How are high-speed (USB, MIPI), sensitive analog, and critical clock signals handled?
4.  **Component-Level Pass:** Are individual components used correctly according to their datasheets (e.g., pin configurations, pull-ups/pull-downs, logic levels)?
5.  **Protection & Reliability Pass:** Is the design protected from real-world events like ESD, over-current, and reverse polarity?
6.  **DFT/DFM Pass (Design for Test/Manufacturability):** Can this board be reliably manufactured, assembled, and tested?

### 1.2 JSON Output Schema for Issues

When the AI finds an issue, it should structure its output in a clear, machine-readable format. This allows for consistent reporting and integration with other tools.

```json
{
  "issues": [
    {
      "rule_id": "PWR_DECPL_001",
      "severity": "Critical",
      "domain": "Power",
      "component_id": ["U5"],
      "net_id": ["+3V3_MCU"],
      "summary": "Missing decoupling capacitor on MCU power pin.",
      "description": "The VDD_CORE pin of MCU U5 is missing a local 100nF decoupling capacitor, which is required to ensure a stable power supply during fast switching operations.",
      "recommended_actions": [
        "Place a 100nF ceramic capacitor (X7R or similar) as close as possible to pin 7 (VDD_CORE) of U5.",
        "Ensure the capacitor's return path to the ground pin is short and direct."
      ],
      "kb_references": ["Section 1.3"]
    }
  ]
}
```

---

## Part 2: Core Engineering Concepts & Rules

This section details common hardware design domains and the key principles to check for.

### 2.1 Power Systems

- **Regulator Choice:** LDOs are simple but inefficient for large voltage drops. Buck/boost converters are efficient but require careful layout.
- **Decoupling:** *Every* IC needs local decoupling. 100nF is standard for high-frequency noise. Bulk caps (10uF+) handle lower-frequency load changes. (See rule `PWR_DECPL_001`).
- **Filtering:** Use ferrite beads or pi filters to isolate noisy sections (like motors or SMPS) from sensitive sections (like analog sensors or RF).
- **Inrush & Polarity:** Protect against hot-plugging and reverse-voltage events with PTC fuses and protection diodes/MOSFETs.

### 2.2 Signal Integrity (SI) & High-Speed Design

- **Impedance Control:** High-speed traces are transmission lines. Their impedance must be controlled (typically 50 single-ended, 90-100 differential) to prevent reflections.
- **Reference Planes:** High-speed signals need a continuous, solid ground or power plane directly beneath them to provide a low-inductance return path. **Never route over a split plane.** (See rule `HS_DIFF_001`).
- **Length Matching:** For parallel buses like DDR or MIPI, traces must be length-matched to ensure simultaneous arrival. (See rule `HS_DDR_001`).
- **Termination:** High-speed lines need termination resistors (series, parallel, or Thevenin) to absorb signal energy and prevent reflections.

### 2.3 Analog & Mixed-Signal

- **Grounding:** Separate analog and digital grounds are an anti-pattern in most mixed-signal PCBs. Use a single, solid ground plane and partition the layout to keep digital return currents away from the analog section.
- **Op-Amps:** Watch for input common-mode range violations and ensure feedback networks don't create instability. (See rule `AN_OPAMP_001`).
- **ADCs:** Protect ADC inputs from over-voltage and include an anti-aliasing filter to remove frequencies above Nyquist. (See rule `AN_ADC_001`).

### 2.4 EMC, ESD & EMI

- **Connectors are Portals:** Every external connector is a potential entry/exit point for ESD and EMI. Protect them with TVS diodes, ferrite beads, and common-mode chokes. (See rule `EMC_ESD_001`).
- **Minimize Loop Area:** Fast-switching currents (like in a buck converter's "hot loop") create magnetic fields (EMI). Minimize the physical loop area of these paths through careful component placement.
- **Shielding & Stitching:** Use ground pours on outer layers and and "stitch" them frequently to the main ground plane with vias, especially along board edges.

### 2.5 DFT & DFM

- **Test Points:** Every power rail and critical signal should be accessible for probing. (See rule `DFT_TP_001`).
- **Silkscreen:** Labels should be clear and unambiguous. Mark pin 1, polarity, and component designators.
- **Fiducials:** At least two (preferably three) fiducial markers are required for automated pick-and-place assembly.
- **Acid Traps:** Avoid acute angles in copper traces where etchant can get trapped, over-etching the trace. Use 45 or rounded corners.

---
## Appendix A  High-Speed Signal Integrity

This appendix provides a deeper, more intuitive look into the physics of high-speed digital signals. At speeds above a few hundred MHz, or with signal rise times faster than ~1 ns, traces on a PCB stop behaving like simple "wires" and must be treated as **transmission lines**.

### A.1 Transmission Line Basics
A trace on a PCB has intrinsic inductance and capacitance per unit length. At high frequencies, the signal "sees" this distributed LC network as a characteristic impedance. When a signal traveling down the trace encounters a change in impedance (e.g., a connector, a via, or a stub), a portion of the signal energy is **reflected** back towards the source, corrupting the original signal.

**Key takeaway:** The goal of high-speed design is to maintain a **constant impedance** from the driver chip to the receiver chip.

### A.2 Characteristic Impedance (`Z0`)
This is the single most important parameter in high-speed design. It's determined by the physical geometry of the trace and the PCB stackup:
- **Trace width** (wider = lower impedance)
- **Dielectric height** (distance to the reference plane, thicker = higher impedance)
- **Dielectric constant** of the PCB material (`Er`, typically ~4.2 for FR-4)

For most single-ended signals (like clocks or address lines), a **50** characteristic impedance is the industry standard. For differential pairs (like USB or PCIe), a **90 or 100** differential impedance is common.

An AI reviewer should check for consistency. If a design mentions "high-speed USB," it should verify that the layout notes or manufacturing files specify a controlled impedance build. This directly relates to ontology rules like `HS_SER_001`.

### A.3 Crosstalk
Crosstalk is the unwanted coupling of energy between two adjacent traces (aggressor and victim). When a signal travels down the aggressor trace, its electromagnetic field can induce a voltage on the victim trace, creating noise.

**Mitigation:**
1.  **Spacing:** Increase the space between traces. A common rule of thumb is the "3W rule," where the center-to-center spacing is at least 3 times the trace width.
2.  **Reference Plane:** A solid ground plane beneath the traces provides a strong return path, containing the fields and reducing crosstalk. Routing over a split plane (`HS_DIFF_001`) dramatically increases crosstalk.
3.  **Guard Traces:** In some cases, a grounded "guard trace" can be run between two signals, but it must be heavily stitched to the ground plane with vias to be effective.

### A.4 Eye Diagrams & Jitter
An eye diagram is a visualization used to assess the quality of a high-speed signal. It is formed by overlaying multiple signal transitions on an oscilloscope.
- **"Open" Eye:** A large, clean opening in the center of the diagram indicates a high-quality signal with low noise and low jitter.
- **"Closed" Eye:** A small or fuzzy opening indicates poor signal integrity, often due to reflections, crosstalk, or impedance mismatches. The receiver may struggle to distinguish between a '1' and a '0'.

**Jitter** is the timing variation of a signal's edges from their ideal positions. Excessive jitter shrinks the eye opening horizontally, reducing timing margin and increasing the bit error rate (BER). It is a primary failure mode addressed by rules like `HS_SER_002` which limit impedance discontinuities from vias and plane crossings.

---
## Appendix A  High-Speed Signal Integrity

This appendix provides a deeper, more intuitive look into the physics of high-speed digital signals. At speeds above a few hundred MHz, or with signal rise times faster than ~1 ns, traces on a PCB stop behaving like simple "wires" and must be treated as **transmission lines**.

### A.1 Transmission Line Basics
A trace on a PCB has intrinsic inductance and capacitance per unit length. At high frequencies, the signal "sees" this distributed LC network as a characteristic impedance. When a signal traveling down the trace encounters a change in impedance (e.g., a connector, a via, or a stub), a portion of the signal energy is **reflected** back towards the source, corrupting the original signal.

**Key takeaway:** The goal of high-speed design is to maintain a **constant impedance** from the driver chip to the receiver chip.

### A.2 Characteristic Impedance (`Z0`)
This is the single most important parameter in high-speed design. It's determined by the physical geometry of the trace and the PCB stackup:
- **Trace width** (wider = lower impedance)
- **Dielectric height** (distance to the reference plane, thicker = higher impedance)
- **Dielectric constant** of the PCB material (`Er`, typically ~4.2 for FR-4)

For most single-ended signals (like clocks or address lines), a **50** characteristic impedance is the industry standard. For differential pairs (like USB or PCIe), a **90 or 100** differential impedance is common.

An AI reviewer should check for consistency. If a design mentions "high-speed USB," it should verify that the layout notes or manufacturing files specify a controlled impedance build. This directly relates to ontology rules like `HS_SER_001`.

### A.3 Crosstalk
Crosstalk is the unwanted coupling of energy between two adjacent traces (aggressor and victim). When a signal travels down the aggressor trace, its electromagnetic field can induce a voltage on the victim trace, creating noise.

**Mitigation:**
1.  **Spacing:** Increase the space between traces. A common rule of thumb is the "3W rule," where the center-to-center spacing is at least 3 times the trace width.
2.  **Reference Plane:** A solid ground plane beneath the traces provides a strong return path, containing the fields and reducing crosstalk. Routing over a split plane (`HS_DIFF_001`) dramatically increases crosstalk.
3.  **Guard Traces:** In some cases, a grounded "guard trace" can be run between two signals, but it must be heavily stitched to the ground plane with vias to be effective.

### A.4 Eye Diagrams & Jitter
An eye diagram is a visualization used to assess the quality of a high-speed signal. It is formed by overlaying multiple signal transitions on an oscilloscope.
- **"Open" Eye:** A large, clean opening in the center of the diagram indicates a high-quality signal with low noise and low jitter.
- **"Closed" Eye:** A small or fuzzy opening indicates poor signal integrity, often due to reflections, crosstalk, or impedance mismatches. The receiver may struggle to distinguish between a '1' and a '0'.

**Jitter** is the timing variation of a signal's edges from their ideal positions. Excessive jitter shrinks the eye opening horizontally, reducing timing margin and increasing the bit error rate (BER). It is a primary failure mode addressed by rules like `HS_SER_002` which limit impedance discontinuities from vias and plane crossings.

---
## Appendix B  Analog Design & Op-Amp Stability

This appendix explores key considerations for robust analog circuit design, with a particular focus on operational amplifiers (op-amps) and data converters. Analog circuits are highly susceptible to noise, parasitic effects, and stability issues, demanding careful design and layout.

### B.1 Op-Amp Stability
Op-amps are fundamental building blocks, but they can oscillate if not properly stabilized.

-   **Large Capacitive Loads (`AN_OPAMP_002`):** Driving a large capacitive load (e.g., a long cable, a large decoupling capacitor) directly with an op-amp's output can create a pole in the feedback loop, leading to instability. An isolation resistor (series resistor) is often needed between the op-amp output and the capacitive load.
-   **Feedback Network Topology (`AN_OPAMP_003`):** The choice of feedback resistors and capacitors significantly impacts an op-amp's frequency response and stability. Incorrect component values or topologies can lead to unexpected gain, oscillations, or poor transient response.
-   **Phase Margin and Gain Margin:** These are key metrics from control theory used to predict stability.
    -   **Phase Margin:** The difference between the phase shift at unity gain frequency and -180. A phase margin of 45-60 is generally desirable.
    -   **Gain Margin:** How much the gain can be increased before oscillation occurs.

### B.2 ADC Driver Requirements
Driving an Analog-to-Digital Converter (ADC) properly is crucial for achieving its specified performance.

-   **Bandwidth vs. Sampling Rate (`AN_ADC_002`):** The amplifier driving an ADC must have sufficient bandwidth to accurately capture the input signal at the ADC's sampling rate. Insufficient bandwidth can lead to signal attenuation, distortion, and increased settling time errors.
-   **RC Anti-Alias Filters (`AN_ADC_003`):** An RC low-pass filter at the ADC input is essential to prevent aliasing. Aliasing occurs when input frequencies above half the sampling rate (Nyquist frequency) are incorrectly interpreted as lower frequencies, corrupting the digital data. The filter's cutoff frequency must be carefully chosen.

### B.3 Sensor Front-End Design
Sensor interfaces often deal with very small, high-impedance signals, making them highly vulnerable to noise.

-   **High-Impedance Nodes Isolation (`AN_SENSOR_001`):** Traces connected to high-impedance inputs (e.g., pH sensors, photodiodes, electret microphones) are extremely sensitive to parasitic capacitance and noise pickup.
    -   **Guard Rings:** Routing a guard ring (a trace connected to a low-impedance reference, often the input buffer's non-inverting input or ground) around the high-impedance trace can absorb leakage currents and shield the signal from noise.
    -   **Shielding:** Keep noisy digital lines and power traces far away from sensitive analog front-ends. Use solid ground planes as shields.
    -   **Minimize Trace Length:** Keep high-impedance traces as short as possible.

---

## Appendix C  SMPS & Power Electronics

This appendix delves into the critical aspects of Switch-Mode Power Supply (SMPS) design and layout, which are often sources of significant noise and instability if not handled correctly.

### C.1 Simplified Buck/Boost Operation
SMPS circuits (like Buck or Boost converters) operate by rapidly switching an inductor, storing energy in its magnetic field and then releasing it to the load. This switching action allows for efficient voltage conversion, but also generates high-frequency current pulses.

-   **Buck Converter (Step-Down):** Switches the input voltage to produce a lower output voltage. Key components include the switching MOSFET(s), inductor, input capacitor (Cin), and output capacitor (Cout).
-   **Boost Converter (Step-Up):** Switches the output current to produce a higher output voltage.

### C.2 Layout "Dos and Don'ts"
Proper layout is paramount for SMPS to achieve stable operation, low noise, and good thermal performance.

#### **Dos:**
-   **Minimize Hot Loops (`PWR_BUCK_001`):** The path of high dI/dt (rate of change of current) needs to be as short and wide as possible. For a buck converter, this is the loop formed by the input capacitor, switching FET(s), and the output diode (if asynchronous) or lower FET (if synchronous). Place these components very close together.
-   **Capacitor Placement (`PWR_BUCK_002`):** Input and output capacitors must be placed directly adjacent to the switching IC's VIN/VOUT and GND pins, with minimal trace inductance. Use multiple small ceramic capacitors in parallel for lower ESL/ESR.
-   **Kelvin Sensing:** For accurate feedback, route the feedback trace from the output capacitor's positive terminal to the feedback pin, avoiding current paths.
-   **Thermal Management:** For components like MOSFETs, diodes, and inductors, provide ample copper pour and thermal vias underneath their pads to dissipate heat. (Related to `PWR_RATING_001`, `PWR_RATING_002` for component limits).

#### **Don'ts:**
-   **Long High-Current Traces:** Avoid long, thin traces in the switching paths, especially the hot loop.
-   **Sensitive Traces Near Switching Nodes:** Route feedback traces and other sensitive signals away from noisy switching nodes (SW node) and inductors.
-   **Ground Plane Interruptions:** Avoid cutting the ground plane beneath critical SMPS components, especially the hot loop, as this disrupts return currents and increases EMI.

### C.3 Compensation and Ringing
An SMPS is a closed-loop system, and like all such systems, it requires a compensation network to maintain stability and ensure good transient response.

-   **Compensation Network (`PWR_COMP_001`):** This is typically an RC network connected to the feedback pin, designed to shape the loop gain and phase response. Without proper compensation, the converter can oscillate or have poor load regulation.
-   **Ringing:** This is oscillatory behavior in voltage or current, often seen at switching nodes. It can be caused by parasitic inductance and capacitance, poor layout, or improper compensation. Excessive ringing can lead to increased EMI, efficiency loss, and even component damage (e.g., exceeding FET Vds ratings). Careful layout and snubber circuits (if needed) can mitigate ringing.

This appendix delves into the critical aspects of Switch-Mode Power Supply (SMPS) design and layout, which are often sources of significant noise and instability if not handled correctly.

### C.1 Simplified Buck/Boost Operation
SMPS circuits (like Buck or Boost converters) operate by rapidly switching an inductor, storing energy in its magnetic field and then releasing it to the load. This switching action allows for efficient voltage conversion, but also generates high-frequency current pulses.

-   **Buck Converter (Step-Down):** Switches the input voltage to produce a lower output voltage. Key components include the switching MOSFET(s), inductor, input capacitor (Cin), and output capacitor (Cout).
-   **Boost Converter (Step-Up):** Switches the output current to produce a higher output voltage.

### C.2 Layout "Dos and Don'ts"
Proper layout is paramount for SMPS to achieve stable operation, low noise, and good thermal performance.

#### **Dos:**
-   **Minimize Hot Loops (`PWR_BUCK_001`):** The path of high dI/dt (rate of change of current) needs to be as short and wide as possible. For a buck converter, this is the loop formed by the input capacitor, switching FET(s), and the output diode (if asynchronous) or lower FET (if synchronous). Place these components very close together.
-   **Capacitor Placement (`PWR_BUCK_002`):** Input and output capacitors must be placed directly adjacent to the switching IC's VIN/VOUT and GND pins, with minimal trace inductance. Use multiple small ceramic capacitors in parallel for lower ESL/ESR.
-   **Kelvin Sensing:** For accurate feedback, route the feedback trace from the output capacitor's positive terminal to the feedback pin, avoiding current paths.
-   **Thermal Management:** For components like MOSFETs, diodes, and inductors, provide ample copper pour and thermal vias underneath their pads to dissipate heat. (Related to `PWR_RATING_001`, `PWR_RATING_002` for component limits).

#### **Don'ts:**
-   **Long High-Current Traces:** Avoid long, thin traces in the switching paths, especially the hot loop.
-   **Sensitive Traces Near Switching Nodes:** Route feedback traces and other sensitive signals away from noisy switching nodes (SW node) and inductors.
-   **Ground Plane Interruptions:** Avoid cutting the ground plane beneath critical SMPS components, especially the hot loop, as this disrupts return currents and increases EMI.

### C.3 Compensation and Ringing
An SMPS is a closed-loop system, and like all such systems, it requires a compensation network to maintain stability and ensure good transient response.

-   **Compensation Network (`PWR_COMP_001`):** This is typically an RC network connected to the feedback pin, designed to shape the loop gain and phase response. Without proper compensation, the converter can oscillate or have poor load regulation.
-   **Ringing:** This is oscillatory behavior in voltage or current, often seen at switching nodes. It can be caused by parasitic inductance and capacitance, poor layout, or improper compensation. Excessive ringing can lead to increased EMI, efficiency loss, and even component damage (e.g., exceeding FET Vds ratings). Careful layout and snubber circuits (if needed) can mitigate ringing.
--- END OF KNOWLEDGE BASE DOCUMENT ---

---
### KNOWLEDGE BASE END
---

### FINAL REVIEW INSTRUCTIONS

When you have all the necessary information (including any you requested from the user), perform a comprehensive review of the uploaded design files.

Follow these instructions for your review:
1.  Analyze all uploaded design files.
2.  Check the design against all applicable rules from all domains (Power, HighSpeed, Analog, EMC, Thermal, Mechanical, etc.) in the ontology provided above.
3.  For every potential issue you identify, please describe the issue clearly and cite the specific `rule_id` it violates.

If you have understood all these steps, acknowledge it and begin with the "Pre-Review Assessment" of the user's uploaded files.
